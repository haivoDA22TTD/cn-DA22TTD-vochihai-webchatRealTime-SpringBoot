<div class="chat-message"
  [class.owner]="messageContent?.sender === currentUser?.username">
  <app-avatar 
    [width]="'40px'"
    [username]="messageContent?.sender">
  </app-avatar>
  <div class="chat-message-content"
    [title]="messageContent?.dateSent | date : 'HH:mm:ss dd/MM/yyyy'">
    <div class="chat-message-username">{{messageContent?.sender}}</div>
    
    <!-- TEXT MESSAGE -->
    <div class="chat-message-text" *ngIf="messageContent?.messageType === 'TEXT'">
      {{messageContent?.content}}
    </div>
    
    <!-- IMAGE MESSAGE -->
    <div class="chat-message-image" *ngIf="messageContent?.messageType === 'IMAGE'">
      <img [src]="messageContent?.content" 
           alt="Image" 
           (error)="onImageError($event)"
           style="max-width: 300px; max-height: 300px; border-radius: 8px; cursor: pointer;" />
    </div>
    
    <!-- LOCATION MESSAGE -->
    <div class="chat-message-location" *ngIf="messageContent?.messageType === 'LOCATION'">
      <div class="location-preview" (click)="openLocationInMaps()">
        <div class="location-icon">üìç</div>
        <div class="location-info">
          <span class="location-label">V·ªã tr√≠ ƒë√£ chia s·∫ª</span>
          <span class="location-coords">{{getLocationCoords()}}</span>
        </div>
        <div class="location-action">
          <span class="material-symbols-rounded">open_in_new</span>
        </div>
      </div>
      <iframe 
        *ngIf="getMapUrl()"
        [src]="getMapUrl()"
        width="280"
        height="150"
        style="border:0; border-radius: 8px; margin-top: 8px;"
        allowfullscreen=""
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade">
      </iframe>
    </div>

    <!-- FILE MESSAGE -->
    <div class="chat-message-file" *ngIf="messageContent?.messageType === 'FILE' && getFileInfo()">
      <div class="file-preview" (click)="downloadFile()">
        <div class="file-icon">{{getFileIcon(getFileInfo()!.extension)}}</div>
        <div class="file-info">
          <span class="file-name">{{getFileInfo()!.name}}</span>
          <span class="file-size">{{formatFileSize(getFileInfo()!.size)}}</span>
        </div>
        <div class="file-action">
          <span class="material-symbols-rounded">download</span>
        </div>
      </div>
    </div>

    <!-- LINK MESSAGE -->
    <div class="chat-message-link" *ngIf="messageContent?.messageType === 'LINK'">
      <div class="link-preview" (click)="openLink()">
        <div class="link-icon">üîó</div>
        <div class="link-content">
          <span class="link-url">{{getLinkUrl()}}</span>
          <span class="link-domain">{{getLinkDomain()}}</span>
        </div>
        <div class="link-action">
          <span class="material-symbols-rounded">open_in_new</span>
        </div>
      </div>
    </div>
  </div>
</div>